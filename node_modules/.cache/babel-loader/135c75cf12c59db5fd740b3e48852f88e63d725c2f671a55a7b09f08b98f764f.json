{"ast":null,"code":"/**\n * Copyright 2021 Trent Mick.\n * Copyright 2020 Joyent Inc.\n *\n * The bunyan logging library for node.js.\n *\n * -*- mode: js -*-\n * vim: expandtab:ts=4:sw=4\n */\n\nvar VERSION = '1.8.15';\n\n/*\n * Bunyan log format version. This becomes the 'v' field on all log records.\n * This will be incremented if there is any backward incompatible change to\n * the log record format. Details will be in 'CHANGES.md' (the change log).\n */\nvar LOG_VERSION = 0;\nvar xxx = function xxx(s) {\n  // internal dev/debug logging\n  var args = ['XX' + 'X: ' + s].concat(Array.prototype.slice.call(arguments, 1));\n  console.error.apply(this, args);\n};\nvar xxx = function xxx() {}; // comment out to turn on debug logging\n\n/*\n * Runtime environment notes:\n *\n * Bunyan is intended to run in a number of runtime environments. Here are\n * some notes on differences for those envs and how the code copes.\n *\n * - node.js: The primary target environment.\n * - NW.js: http://nwjs.io/  An *app* environment that feels like both a\n *   node env -- it has node-like globals (`process`, `global`) and\n *   browser-like globals (`window`, `navigator`). My *understanding* is that\n *   bunyan can operate as if this is vanilla node.js.\n * - browser: Failing the above, we sniff using the `window` global\n *   <https://developer.mozilla.org/en-US/docs/Web/API/Window/window>.\n *      - browserify: http://browserify.org/  A browser-targetting bundler of\n *        node.js deps. The runtime is a browser env, so can't use fs access,\n *        etc. Browserify's build looks for `require(<single-string>)` imports\n *        to bundle. For some imports it won't be able to handle, we \"hide\"\n *        from browserify with `require('frobshizzle' + '')`.\n * - Other? Please open issues if things are broken.\n */\nvar runtimeEnv;\nif (typeof process !== 'undefined' && process.versions) {\n  if (process.versions.nw) {\n    runtimeEnv = 'nw';\n  } else if (process.versions.node) {\n    runtimeEnv = 'node';\n  }\n}\nif (!runtimeEnv && typeof window !== 'undefined' && window.window === window) {\n  runtimeEnv = 'browser';\n}\nif (!runtimeEnv) {\n  throw new Error('unknown runtime environment');\n}\nvar os, fs, dtrace;\nif (runtimeEnv === 'browser') {\n  os = {\n    hostname: function () {\n      return window.location.host;\n    }\n  };\n  fs = {};\n  dtrace = null;\n} else {\n  os = require('os');\n  fs = require('fs');\n  try {\n    dtrace = require('dtrace-provider' + '');\n  } catch (e) {\n    dtrace = null;\n  }\n}\nvar util = require('util');\nvar assert = require('assert');\nvar EventEmitter = require('events').EventEmitter;\nvar stream = require('stream');\ntry {\n  var safeJsonStringify = require('safe-json-stringify');\n} catch (e) {\n  safeJsonStringify = null;\n}\nif (process.env.BUNYAN_TEST_NO_SAFE_JSON_STRINGIFY) {\n  safeJsonStringify = null;\n}\n\n// The 'mv' module is required for rotating-file stream support.\ntry {\n  var mv = require('mv' + '');\n} catch (e) {\n  mv = null;\n}\ntry {\n  var sourceMapSupport = require('source-map-support' + '');\n} catch (_) {\n  sourceMapSupport = null;\n}\n\n//---- Internal support stuff\n\n/**\n * A shallow copy of an object. Bunyan logging attempts to never cause\n * exceptions, so this function attempts to handle non-objects gracefully.\n */\nfunction objCopy(obj) {\n  if (obj == null) {\n    // null or undefined\n    return obj;\n  } else if (Array.isArray(obj)) {\n    return obj.slice();\n  } else if (typeof obj === 'object') {\n    var copy = {};\n    Object.keys(obj).forEach(function (k) {\n      copy[k] = obj[k];\n    });\n    return copy;\n  } else {\n    return obj;\n  }\n}\nvar format = util.format;\nif (!format) {\n  // If node < 0.6, then use its `util.format`:\n  // <https://github.com/joyent/node/blob/master/lib/util.js#L22>:\n  var inspect = util.inspect;\n  var formatRegExp = /%[sdj%]/g;\n  format = function format(f) {\n    if (typeof f !== 'string') {\n      var objects = [];\n      for (var i = 0; i < arguments.length; i++) {\n        objects.push(inspect(arguments[i]));\n      }\n      return objects.join(' ');\n    }\n    var i = 1;\n    var args = arguments;\n    var len = args.length;\n    var str = String(f).replace(formatRegExp, function (x) {\n      if (i >= len) return x;\n      switch (x) {\n        case '%s':\n          return String(args[i++]);\n        case '%d':\n          return Number(args[i++]);\n        case '%j':\n          return fastAndSafeJsonStringify(args[i++]);\n        case '%%':\n          return '%';\n        default:\n          return x;\n      }\n    });\n    for (var x = args[i]; i < len; x = args[++i]) {\n      if (x === null || typeof x !== 'object') {\n        str += ' ' + x;\n      } else {\n        str += ' ' + inspect(x);\n      }\n    }\n    return str;\n  };\n}\n\n/**\n * Gather some caller info 3 stack levels up.\n * See <http://code.google.com/p/v8/wiki/JavaScriptStackTraceApi>.\n */\nfunction getCaller3Info() {\n  if (this === undefined) {\n    // Cannot access caller info in 'strict' mode.\n    return;\n  }\n  var obj = {};\n  var saveLimit = Error.stackTraceLimit;\n  var savePrepare = Error.prepareStackTrace;\n  Error.stackTraceLimit = 3;\n  Error.prepareStackTrace = function (_, stack) {\n    var caller = stack[2];\n    if (sourceMapSupport) {\n      caller = sourceMapSupport.wrapCallSite(caller);\n    }\n    obj.file = caller.getFileName();\n    obj.line = caller.getLineNumber();\n    var func = caller.getFunctionName();\n    if (func) obj.func = func;\n  };\n  Error.captureStackTrace(this, getCaller3Info);\n  this.stack;\n  Error.stackTraceLimit = saveLimit;\n  Error.prepareStackTrace = savePrepare;\n  return obj;\n}\nfunction _indent(s, indent) {\n  if (!indent) indent = '    ';\n  var lines = s.split(/\\r?\\n/g);\n  return indent + lines.join('\\n' + indent);\n}\n\n/**\n * Warn about an bunyan processing error.\n *\n * @param msg {String} Message with which to warn.\n * @param dedupKey {String} Optional. A short string key for this warning to\n *      have its warning only printed once.\n */\nfunction _warn(msg, dedupKey) {\n  assert.ok(msg);\n  if (dedupKey) {\n    if (_warned[dedupKey]) {\n      return;\n    }\n    _warned[dedupKey] = true;\n  }\n  process.stderr.write(msg + '\\n');\n}\nfunction _haveWarned(dedupKey) {\n  return _warned[dedupKey];\n}\nvar _warned = {};\nfunction ConsoleRawStream() {}\nConsoleRawStream.prototype.write = function (rec) {\n  if (rec.level < INFO) {\n    console.log(rec);\n  } else if (rec.level < WARN) {\n    console.info(rec);\n  } else if (rec.level < ERROR) {\n    console.warn(rec);\n  } else {\n    console.error(rec);\n  }\n};\n\n//---- Levels\n\nvar TRACE = 10;\nvar DEBUG = 20;\nvar INFO = 30;\nvar WARN = 40;\nvar ERROR = 50;\nvar FATAL = 60;\nvar levelFromName = {\n  'trace': TRACE,\n  'debug': DEBUG,\n  'info': INFO,\n  'warn': WARN,\n  'error': ERROR,\n  'fatal': FATAL\n};\nvar nameFromLevel = {};\nObject.keys(levelFromName).forEach(function (name) {\n  nameFromLevel[levelFromName[name]] = name;\n});\n\n// Dtrace probes.\nvar dtp = undefined;\nvar probes = dtrace && {};\n\n/**\n * Resolve a level number, name (upper or lowercase) to a level number value.\n *\n * @param nameOrNum {String|Number} A level name (case-insensitive) or positive\n *      integer level.\n * @api public\n */\nfunction resolveLevel(nameOrNum) {\n  var level;\n  var type = typeof nameOrNum;\n  if (type === 'string') {\n    level = levelFromName[nameOrNum.toLowerCase()];\n    if (!level) {\n      throw new Error(format('unknown level name: \"%s\"', nameOrNum));\n    }\n  } else if (type !== 'number') {\n    throw new TypeError(format('cannot resolve level: invalid arg (%s):', type, nameOrNum));\n  } else if (nameOrNum < 0 || Math.floor(nameOrNum) !== nameOrNum) {\n    throw new TypeError(format('level is not a positive integer: %s', nameOrNum));\n  } else {\n    level = nameOrNum;\n  }\n  return level;\n}\nfunction isWritable(obj) {\n  if (obj instanceof stream.Writable) {\n    return true;\n  }\n  return typeof obj.write === 'function';\n}\n\n//---- Logger class\n\n/**\n * Create a Logger instance.\n *\n * @param options {Object} See documentation for full details. At minimum\n *    this must include a 'name' string key. Configuration keys:\n *      - `streams`: specify the logger output streams. This is an array of\n *        objects with these fields:\n *          - `type`: The stream type. See README.md for full details.\n *            Often this is implied by the other fields. Examples are\n *            'file', 'stream' and \"raw\".\n *          - `level`: Defaults to 'info'.\n *          - `path` or `stream`: The specify the file path or writeable\n *            stream to which log records are written. E.g.\n *            `stream: process.stdout`.\n *          - `closeOnExit` (boolean): Optional. Default is true for a\n *            'file' stream when `path` is given, false otherwise.\n *        See README.md for full details.\n *      - `level`: set the level for a single output stream (cannot be used\n *        with `streams`)\n *      - `stream`: the output stream for a logger with just one, e.g.\n *        `process.stdout` (cannot be used with `streams`)\n *      - `serializers`: object mapping log record field names to\n *        serializing functions. See README.md for details.\n *      - `src`: Boolean (default false). Set true to enable 'src' automatic\n *        field with log call source info.\n *    All other keys are log record fields.\n *\n * An alternative *internal* call signature is used for creating a child:\n *    new Logger(<parent logger>, <child options>[, <child opts are simple>]);\n *\n * @param _childSimple (Boolean) An assertion that the given `_childOptions`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation.\n */\nfunction Logger(options, _childOptions, _childSimple) {\n  xxx('Logger start:', options);\n  if (!(this instanceof Logger)) {\n    return new Logger(options, _childOptions);\n  }\n\n  // Input arg validation.\n  var parent;\n  if (_childOptions !== undefined) {\n    parent = options;\n    options = _childOptions;\n    if (!(parent instanceof Logger)) {\n      throw new TypeError('invalid Logger creation: do not pass a second arg');\n    }\n  }\n  if (!options) {\n    throw new TypeError('options (object) is required');\n  }\n  if (!parent) {\n    if (!options.name) {\n      throw new TypeError('options.name (string) is required');\n    }\n  } else {\n    if (options.name) {\n      throw new TypeError('invalid options.name: child cannot set logger name');\n    }\n  }\n  if (options.stream && options.streams) {\n    throw new TypeError('cannot mix \"streams\" and \"stream\" options');\n  }\n  if (options.streams && !Array.isArray(options.streams)) {\n    throw new TypeError('invalid options.streams: must be an array');\n  }\n  if (options.serializers && (typeof options.serializers !== 'object' || Array.isArray(options.serializers))) {\n    throw new TypeError('invalid options.serializers: must be an object');\n  }\n  EventEmitter.call(this);\n\n  // Fast path for simple child creation.\n  if (parent && _childSimple) {\n    // `_isSimpleChild` is a signal to stream close handling that this child\n    // owns none of its streams.\n    this._isSimpleChild = true;\n    this._level = parent._level;\n    this.streams = parent.streams;\n    this.serializers = parent.serializers;\n    this.src = parent.src;\n    var fields = this.fields = {};\n    var parentFieldNames = Object.keys(parent.fields);\n    for (var i = 0; i < parentFieldNames.length; i++) {\n      var name = parentFieldNames[i];\n      fields[name] = parent.fields[name];\n    }\n    var names = Object.keys(options);\n    for (var i = 0; i < names.length; i++) {\n      var name = names[i];\n      fields[name] = options[name];\n    }\n    return;\n  }\n\n  // Start values.\n  var self = this;\n  if (parent) {\n    this._level = parent._level;\n    this.streams = [];\n    for (var i = 0; i < parent.streams.length; i++) {\n      var s = objCopy(parent.streams[i]);\n      s.closeOnExit = false; // Don't own parent stream.\n      this.streams.push(s);\n    }\n    this.serializers = objCopy(parent.serializers);\n    this.src = parent.src;\n    this.fields = objCopy(parent.fields);\n    if (options.level) {\n      this.level(options.level);\n    }\n  } else {\n    this._level = Number.POSITIVE_INFINITY;\n    this.streams = [];\n    this.serializers = null;\n    this.src = false;\n    this.fields = {};\n  }\n  if (!dtp && dtrace) {\n    dtp = dtrace.createDTraceProvider('bunyan');\n    for (var level in levelFromName) {\n      var probe;\n      probes[levelFromName[level]] = probe = dtp.addProbe('log-' + level, 'char *');\n\n      // Explicitly add a reference to dtp to prevent it from being GC'd\n      probe.dtp = dtp;\n    }\n    dtp.enable();\n  }\n\n  // Handle *config* options (i.e. options that are not just plain data\n  // for log records).\n  if (options.stream) {\n    self.addStream({\n      type: 'stream',\n      stream: options.stream,\n      closeOnExit: false,\n      level: options.level\n    });\n  } else if (options.streams) {\n    options.streams.forEach(function (s) {\n      self.addStream(s, options.level);\n    });\n  } else if (parent && options.level) {\n    this.level(options.level);\n  } else if (!parent) {\n    if (runtimeEnv === 'browser') {\n      /*\n       * In the browser we'll be emitting to console.log by default.\n       * Any console.log worth its salt these days can nicely render\n       * and introspect objects (e.g. the Firefox and Chrome console)\n       * so let's emit the raw log record. Are there browsers for which\n       * that breaks things?\n       */\n      self.addStream({\n        type: 'raw',\n        stream: new ConsoleRawStream(),\n        closeOnExit: false,\n        level: options.level\n      });\n    } else {\n      self.addStream({\n        type: 'stream',\n        stream: process.stdout,\n        closeOnExit: false,\n        level: options.level\n      });\n    }\n  }\n  if (options.serializers) {\n    self.addSerializers(options.serializers);\n  }\n  if (options.src) {\n    this.src = true;\n  }\n  xxx('Logger: ', self);\n\n  // Fields.\n  // These are the default fields for log records (minus the attributes\n  // removed in this constructor). To allow storing raw log records\n  // (unrendered), `this.fields` must never be mutated. Create a copy for\n  // any changes.\n  var fields = objCopy(options);\n  delete fields.stream;\n  delete fields.level;\n  delete fields.streams;\n  delete fields.serializers;\n  delete fields.src;\n  if (this.serializers) {\n    this._applySerializers(fields);\n  }\n  if (!fields.hostname && !self.fields.hostname) {\n    fields.hostname = os.hostname();\n  }\n  if (!fields.pid) {\n    fields.pid = process.pid;\n  }\n  Object.keys(fields).forEach(function (k) {\n    self.fields[k] = fields[k];\n  });\n}\nutil.inherits(Logger, EventEmitter);\n\n/**\n * Add a stream\n *\n * @param stream {Object}. Object with these fields:\n *    - `type`: The stream type. See README.md for full details.\n *      Often this is implied by the other fields. Examples are\n *      'file', 'stream' and \"raw\".\n *    - `path` or `stream`: The specify the file path or writeable\n *      stream to which log records are written. E.g.\n *      `stream: process.stdout`.\n *    - `level`: Optional. Falls back to `defaultLevel`.\n *    - `closeOnExit` (boolean): Optional. Default is true for a\n *      'file' stream when `path` is given, false otherwise.\n *    See README.md for full details.\n * @param defaultLevel {Number|String} Optional. A level to use if\n *      `stream.level` is not set. If neither is given, this defaults to INFO.\n */\nLogger.prototype.addStream = function addStream(s, defaultLevel) {\n  var self = this;\n  if (defaultLevel === null || defaultLevel === undefined) {\n    defaultLevel = INFO;\n  }\n  s = objCopy(s);\n\n  // Implicit 'type' from other args.\n  if (!s.type) {\n    if (s.stream) {\n      s.type = 'stream';\n    } else if (s.path) {\n      s.type = 'file';\n    }\n  }\n  s.raw = s.type === 'raw'; // PERF: Allow for faster check in `_emit`.\n\n  if (s.level !== undefined) {\n    s.level = resolveLevel(s.level);\n  } else {\n    s.level = resolveLevel(defaultLevel);\n  }\n  if (s.level < self._level) {\n    self._level = s.level;\n  }\n  switch (s.type) {\n    case 'stream':\n      assert.ok(isWritable(s.stream), '\"stream\" stream is not writable: ' + util.inspect(s.stream));\n      if (!s.closeOnExit) {\n        s.closeOnExit = false;\n      }\n      break;\n    case 'file':\n      if (s.reemitErrorEvents === undefined) {\n        s.reemitErrorEvents = true;\n      }\n      if (!s.stream) {\n        s.stream = fs.createWriteStream(s.path, {\n          flags: 'a',\n          encoding: 'utf8'\n        });\n        if (!s.closeOnExit) {\n          s.closeOnExit = true;\n        }\n      } else {\n        if (!s.closeOnExit) {\n          s.closeOnExit = false;\n        }\n      }\n      break;\n    case 'rotating-file':\n      assert.ok(!s.stream, '\"rotating-file\" stream should not give a \"stream\"');\n      assert.ok(s.path);\n      assert.ok(mv, '\"rotating-file\" stream type is not supported: ' + 'missing \"mv\" module');\n      s.stream = new RotatingFileStream(s);\n      if (!s.closeOnExit) {\n        s.closeOnExit = true;\n      }\n      break;\n    case 'raw':\n      if (!s.closeOnExit) {\n        s.closeOnExit = false;\n      }\n      break;\n    default:\n      throw new TypeError('unknown stream type \"' + s.type + '\"');\n  }\n  if (s.reemitErrorEvents && typeof s.stream.on === 'function') {\n    // TODO: When we have `<logger>.close()`, it should remove event\n    //      listeners to not leak Logger instances.\n    s.stream.on('error', function onStreamError(err) {\n      self.emit('error', err, s);\n    });\n  }\n  self.streams.push(s);\n  delete self.haveNonRawStreams; // reset\n};\n\n/**\n * Add serializers\n *\n * @param serializers {Object} Optional. Object mapping log record field names\n *    to serializing functions. See README.md for details.\n */\nLogger.prototype.addSerializers = function addSerializers(serializers) {\n  var self = this;\n  if (!self.serializers) {\n    self.serializers = {};\n  }\n  Object.keys(serializers).forEach(function (field) {\n    var serializer = serializers[field];\n    if (typeof serializer !== 'function') {\n      throw new TypeError(format('invalid serializer for \"%s\" field: must be a function', field));\n    } else {\n      self.serializers[field] = serializer;\n    }\n  });\n};\n\n/**\n * Create a child logger, typically to add a few log record fields.\n *\n * This can be useful when passing a logger to a sub-component, e.g. a\n * 'wuzzle' component of your service:\n *\n *    var wuzzleLog = log.child({component: 'wuzzle'})\n *    var wuzzle = new Wuzzle({..., log: wuzzleLog})\n *\n * Then log records from the wuzzle code will have the same structure as\n * the app log, *plus the component='wuzzle' field*.\n *\n * @param options {Object} Optional. Set of options to apply to the child.\n *    All of the same options for a new Logger apply here. Notes:\n *      - The parent's streams are inherited and cannot be removed in this\n *        call. Any given `streams` are *added* to the set inherited from\n *        the parent.\n *      - The parent's serializers are inherited, though can effectively be\n *        overwritten by using duplicate keys.\n *      - Can use `level` to set the level of the streams inherited from\n *        the parent. The level for the parent is NOT affected.\n * @param simple {Boolean} Optional. Set to true to assert that `options`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation. See 'tools/timechild.js' for numbers.\n */\nLogger.prototype.child = function (options, simple) {\n  return new this.constructor(this, options || {}, simple);\n};\n\n/**\n * A convenience method to reopen 'file' streams on a logger. This can be\n * useful with external log rotation utilities that move and re-open log files\n * (e.g. logrotate on Linux, logadm on SmartOS/Illumos). Those utilities\n * typically have rotation options to copy-and-truncate the log file, but\n * you may not want to use that. An alternative is to do this in your\n * application:\n *\n *      var log = bunyan.createLogger(...);\n *      ...\n *      process.on('SIGUSR2', function () {\n *          log.reopenFileStreams();\n *      });\n *      ...\n *\n * See <https://github.com/trentm/node-bunyan/issues/104>.\n */\nLogger.prototype.reopenFileStreams = function () {\n  var self = this;\n  self.streams.forEach(function (s) {\n    if (s.type === 'file') {\n      if (s.stream) {\n        // Not sure if typically would want this, or more immediate\n        // `s.stream.destroy()`.\n        s.stream.end();\n        s.stream.destroySoon();\n        delete s.stream;\n      }\n      s.stream = fs.createWriteStream(s.path, {\n        flags: 'a',\n        encoding: 'utf8'\n      });\n      s.stream.on('error', function (err) {\n        self.emit('error', err, s);\n      });\n    }\n  });\n};\n\n/* BEGIN JSSTYLED */\n/**\n * Close this logger.\n *\n * This closes streams (that it owns, as per 'endOnClose' attributes on\n * streams), etc. Typically you **don't** need to bother calling this.\nLogger.prototype.close = function () {\n    if (this._closed) {\n        return;\n    }\n    if (!this._isSimpleChild) {\n        self.streams.forEach(function (s) {\n            if (s.endOnClose) {\n                xxx('closing stream s:', s);\n                s.stream.end();\n                s.endOnClose = false;\n            }\n        });\n    }\n    this._closed = true;\n}\n */\n/* END JSSTYLED */\n\n/**\n * Get/set the level of all streams on this logger.\n *\n * Get Usage:\n *    // Returns the current log level (lowest level of all its streams).\n *    log.level() -> INFO\n *\n * Set Usage:\n *    log.level(INFO)       // set all streams to level INFO\n *    log.level('info')     // can use 'info' et al aliases\n */\nLogger.prototype.level = function level(value) {\n  if (value === undefined) {\n    return this._level;\n  }\n  var newLevel = resolveLevel(value);\n  var len = this.streams.length;\n  for (var i = 0; i < len; i++) {\n    this.streams[i].level = newLevel;\n  }\n  this._level = newLevel;\n};\n\n/**\n * Get/set the level of a particular stream on this logger.\n *\n * Get Usage:\n *    // Returns an array of the levels of each stream.\n *    log.levels() -> [TRACE, INFO]\n *\n *    // Returns a level of the identified stream.\n *    log.levels(0) -> TRACE      // level of stream at index 0\n *    log.levels('foo')           // level of stream with name 'foo'\n *\n * Set Usage:\n *    log.levels(0, INFO)         // set level of stream 0 to INFO\n *    log.levels(0, 'info')       // can use 'info' et al aliases\n *    log.levels('foo', WARN)     // set stream named 'foo' to WARN\n *\n * Stream names: When streams are defined, they can optionally be given\n * a name. For example,\n *       log = new Logger({\n *         streams: [\n *           {\n *             name: 'foo',\n *             path: '/var/log/my-service/foo.log'\n *             level: 'trace'\n *           },\n *         ...\n *\n * @param name {String|Number} The stream index or name.\n * @param value {Number|String} The level value (INFO) or alias ('info').\n *    If not given, this is a 'get' operation.\n * @throws {Error} If there is no stream with the given name.\n */\nLogger.prototype.levels = function levels(name, value) {\n  if (name === undefined) {\n    assert.equal(value, undefined);\n    return this.streams.map(function (s) {\n      return s.level;\n    });\n  }\n  var stream;\n  if (typeof name === 'number') {\n    stream = this.streams[name];\n    if (stream === undefined) {\n      throw new Error('invalid stream index: ' + name);\n    }\n  } else {\n    var len = this.streams.length;\n    for (var i = 0; i < len; i++) {\n      var s = this.streams[i];\n      if (s.name === name) {\n        stream = s;\n        break;\n      }\n    }\n    if (!stream) {\n      throw new Error(format('no stream with name \"%s\"', name));\n    }\n  }\n  if (value === undefined) {\n    return stream.level;\n  } else {\n    var newLevel = resolveLevel(value);\n    stream.level = newLevel;\n    if (newLevel < this._level) {\n      this._level = newLevel;\n    }\n  }\n};\n\n/**\n * Apply registered serializers to the appropriate keys in the given fields.\n *\n * Pre-condition: This is only called if there is at least one serializer.\n *\n * @param fields (Object) The log record fields.\n * @param excludeFields (Object) Optional mapping of keys to `true` for\n *    keys to NOT apply a serializer.\n */\nLogger.prototype._applySerializers = function (fields, excludeFields) {\n  var self = this;\n  xxx('_applySerializers: excludeFields', excludeFields);\n\n  // Check each serializer against these (presuming number of serializers\n  // is typically less than number of fields).\n  Object.keys(this.serializers).forEach(function (name) {\n    if (fields[name] === undefined || excludeFields && excludeFields[name]) {\n      return;\n    }\n    xxx('_applySerializers; apply to \"%s\" key', name);\n    try {\n      fields[name] = self.serializers[name](fields[name]);\n    } catch (err) {\n      _warn(format('bunyan: ERROR: Exception thrown from the \"%s\" ' + 'Bunyan serializer. This should never happen. This is a bug ' + 'in that serializer function.\\n%s', name, err.stack || err));\n      fields[name] = format('(Error in Bunyan log \"%s\" serializer ' + 'broke field. See stderr for details.)', name);\n    }\n  });\n};\n\n/**\n * Emit a log record.\n *\n * @param rec {log record}\n * @param noemit {Boolean} Optional. Set to true to skip emission\n *      and just return the JSON string.\n */\nLogger.prototype._emit = function (rec, noemit) {\n  var i;\n\n  // Lazily determine if this Logger has non-'raw' streams. If there are\n  // any, then we need to stringify the log record.\n  if (this.haveNonRawStreams === undefined) {\n    this.haveNonRawStreams = false;\n    for (i = 0; i < this.streams.length; i++) {\n      if (!this.streams[i].raw) {\n        this.haveNonRawStreams = true;\n        break;\n      }\n    }\n  }\n\n  // Stringify the object (creates a warning str on error).\n  var str;\n  if (noemit || this.haveNonRawStreams) {\n    str = fastAndSafeJsonStringify(rec) + os.EOL;\n  }\n  if (noemit) return str;\n  var level = rec.level;\n  for (i = 0; i < this.streams.length; i++) {\n    var s = this.streams[i];\n    if (s.level <= level) {\n      xxx('writing log rec \"%s\" to \"%s\" stream (%d <= %d): %j', rec.msg, s.type, s.level, level, rec);\n      s.stream.write(s.raw ? rec : str);\n    }\n  }\n  ;\n  return str;\n};\n\n/**\n * Build a record object suitable for emitting from the arguments\n * provided to the a log emitter.\n */\nfunction mkRecord(log, minLevel, args) {\n  var excludeFields, fields, msgArgs;\n  if (args[0] instanceof Error) {\n    // `log.<level>(err, ...)`\n    fields = {\n      // Use this Logger's err serializer, if defined.\n      err: log.serializers && log.serializers.err ? log.serializers.err(args[0]) : Logger.stdSerializers.err(args[0])\n    };\n    excludeFields = {\n      err: true\n    };\n    if (args.length === 1) {\n      msgArgs = [fields.err.message];\n    } else {\n      msgArgs = args.slice(1);\n    }\n  } else if (typeof args[0] !== 'object' || Array.isArray(args[0])) {\n    // `log.<level>(msg, ...)`\n    fields = null;\n    msgArgs = args.slice();\n  } else if (Buffer.isBuffer(args[0])) {\n    // `log.<level>(buf, ...)`\n    // Almost certainly an error, show `inspect(buf)`. See bunyan\n    // issue #35.\n    fields = null;\n    msgArgs = args.slice();\n    msgArgs[0] = util.inspect(msgArgs[0]);\n  } else {\n    // `log.<level>(fields, msg, ...)`\n    fields = args[0];\n    if (fields && args.length === 1 && fields.err && fields.err instanceof Error) {\n      msgArgs = [fields.err.message];\n    } else {\n      msgArgs = args.slice(1);\n    }\n  }\n\n  // Build up the record object.\n  var rec = objCopy(log.fields);\n  var level = rec.level = minLevel;\n  var recFields = fields ? objCopy(fields) : null;\n  if (recFields) {\n    if (log.serializers) {\n      log._applySerializers(recFields, excludeFields);\n    }\n    Object.keys(recFields).forEach(function (k) {\n      rec[k] = recFields[k];\n    });\n  }\n  rec.msg = format.apply(log, msgArgs);\n  if (!rec.time) {\n    rec.time = new Date();\n  }\n  // Get call source info\n  if (log.src && !rec.src) {\n    rec.src = getCaller3Info();\n  }\n  rec.v = LOG_VERSION;\n  return rec;\n}\n;\n\n/**\n * Build an array that dtrace-provider can use to fire a USDT probe. If we've\n * already built the appropriate string, we use it. Otherwise, build the\n * record object and stringify it.\n */\nfunction mkProbeArgs(str, log, minLevel, msgArgs) {\n  return [str || log._emit(mkRecord(log, minLevel, msgArgs), true)];\n}\n\n/**\n * Build a log emitter function for level minLevel. I.e. this is the\n * creator of `log.info`, `log.error`, etc.\n */\nfunction mkLogEmitter(minLevel) {\n  return function () {\n    var log = this;\n    var str = null;\n    var rec = null;\n    if (!this._emit) {\n      /*\n       * Show this invalid Bunyan usage warning *once*.\n       *\n       * See <https://github.com/trentm/node-bunyan/issues/100> for\n       * an example of how this can happen.\n       */\n      var dedupKey = 'unbound';\n      if (!_haveWarned[dedupKey]) {\n        var caller = getCaller3Info();\n        _warn(format('bunyan usage error: %s:%s: attempt to log ' + 'with an unbound log method: `this` is: %s', caller.file, caller.line, util.inspect(this)), dedupKey);\n      }\n      return;\n    } else if (arguments.length === 0) {\n      // `log.<level>()`\n      return this._level <= minLevel;\n    }\n    var msgArgs = new Array(arguments.length);\n    for (var i = 0; i < msgArgs.length; ++i) {\n      msgArgs[i] = arguments[i];\n    }\n    if (this._level <= minLevel) {\n      rec = mkRecord(log, minLevel, msgArgs);\n      str = this._emit(rec);\n    }\n    if (probes) {\n      probes[minLevel].fire(mkProbeArgs, str, log, minLevel, msgArgs);\n    }\n  };\n}\n\n/**\n * The functions below log a record at a specific level.\n *\n * Usages:\n *    log.<level>()  -> boolean is-trace-enabled\n *    log.<level>(<Error> err, [<string> msg, ...])\n *    log.<level>(<string> msg, ...)\n *    log.<level>(<object> fields, <string> msg, ...)\n *\n * where <level> is the lowercase version of the log level. E.g.:\n *\n *    log.info()\n *\n * @params fields {Object} Optional set of additional fields to log.\n * @params msg {String} Log message. This can be followed by additional\n *    arguments that are handled like\n *    [util.format](http://nodejs.org/docs/latest/api/all.html#util.format).\n */\nLogger.prototype.trace = mkLogEmitter(TRACE);\nLogger.prototype.debug = mkLogEmitter(DEBUG);\nLogger.prototype.info = mkLogEmitter(INFO);\nLogger.prototype.warn = mkLogEmitter(WARN);\nLogger.prototype.error = mkLogEmitter(ERROR);\nLogger.prototype.fatal = mkLogEmitter(FATAL);\n\n//---- Standard serializers\n// A serializer is a function that serializes a JavaScript object to a\n// JSON representation for logging. There is a standard set of presumed\n// interesting objects in node.js-land.\n\nLogger.stdSerializers = {};\n\n// Serialize an HTTP request.\nLogger.stdSerializers.req = function (req) {\n  if (!req || !req.connection) return req;\n  return {\n    method: req.method,\n    // Accept `req.originalUrl` for expressjs usage.\n    // https://expressjs.com/en/api.html#req.originalUrl\n    url: req.originalUrl || req.url,\n    headers: req.headers,\n    remoteAddress: req.connection.remoteAddress,\n    remotePort: req.connection.remotePort\n  };\n  // Trailers: Skipping for speed. If you need trailers in your app, then\n  // make a custom serializer.\n  //if (Object.keys(trailers).length > 0) {\n  //  obj.trailers = req.trailers;\n  //}\n};\n\n// Serialize an HTTP response.\nLogger.stdSerializers.res = function (res) {\n  if (!res || !res.statusCode) return res;\n  return {\n    statusCode: res.statusCode,\n    header: res._header\n  };\n};\n\n/*\n * This function dumps long stack traces for exceptions having a cause()\n * method. The error classes from\n * [verror](https://github.com/davepacheco/node-verror) and\n * [restify v2.0](https://github.com/mcavage/node-restify) are examples.\n *\n * Based on `dumpException` in\n * https://github.com/davepacheco/node-extsprintf/blob/master/lib/extsprintf.js\n */\nfunction getFullErrorStack(ex) {\n  var ret = ex.stack || ex.toString();\n  if (ex.cause && typeof ex.cause === 'function') {\n    var cex = ex.cause();\n    if (cex) {\n      ret += '\\nCaused by: ' + getFullErrorStack(cex);\n    }\n  }\n  return ret;\n}\n\n// Serialize an Error object\n// (Core error properties are enumerable in node 0.4, not in 0.6).\nvar errSerializer = Logger.stdSerializers.err = function (err) {\n  if (!err || !err.stack) return err;\n  var obj = {\n    message: err.message,\n    name: err.name,\n    stack: getFullErrorStack(err),\n    code: err.code,\n    signal: err.signal\n  };\n  return obj;\n};\n\n// A JSON stringifier that handles cycles safely - tracks seen values in a Set.\nfunction safeCyclesSet() {\n  var seen = new Set();\n  return function (key, val) {\n    if (!val || typeof val !== 'object') {\n      return val;\n    }\n    if (seen.has(val)) {\n      return '[Circular]';\n    }\n    seen.add(val);\n    return val;\n  };\n}\n\n/**\n * A JSON stringifier that handles cycles safely - tracks seen vals in an Array.\n *\n * Note: This approach has performance problems when dealing with large objects,\n * see trentm/node-bunyan#445, but since this is the only option for node 0.10\n * and earlier (as Set was introduced in Node 0.12), it's used as a fallback\n * when Set is not available.\n */\nfunction safeCyclesArray() {\n  var seen = [];\n  return function (key, val) {\n    if (!val || typeof val !== 'object') {\n      return val;\n    }\n    if (seen.indexOf(val) !== -1) {\n      return '[Circular]';\n    }\n    seen.push(val);\n    return val;\n  };\n}\n\n/**\n * A JSON stringifier that handles cycles safely.\n *\n * Usage: JSON.stringify(obj, safeCycles())\n *\n * Choose the best safe cycle function from what is available - see\n * trentm/node-bunyan#445.\n */\nvar safeCycles = typeof Set !== 'undefined' ? safeCyclesSet : safeCyclesArray;\n\n/**\n * A fast JSON.stringify that handles cycles and getter exceptions (when\n * safeJsonStringify is installed).\n *\n * This function attempts to use the regular JSON.stringify for speed, but on\n * error (e.g. JSON cycle detection exception) it falls back to safe stringify\n * handlers that can deal with cycles and/or getter exceptions.\n */\nfunction fastAndSafeJsonStringify(rec) {\n  try {\n    return JSON.stringify(rec);\n  } catch (ex) {\n    try {\n      return JSON.stringify(rec, safeCycles());\n    } catch (e) {\n      if (safeJsonStringify) {\n        return safeJsonStringify(rec);\n      } else {\n        var dedupKey = e.stack.split(/\\n/g, 3).join('\\n');\n        _warn('bunyan: ERROR: Exception in ' + '`JSON.stringify(rec)`. You can install the ' + '\"safe-json-stringify\" module to have Bunyan fallback ' + 'to safer stringification. Record:\\n' + _indent(format('%s\\n%s', util.inspect(rec), e.stack)), dedupKey);\n        return format('(Exception in JSON.stringify(rec): %j. ' + 'See stderr for details.)', e.message);\n      }\n    }\n  }\n}\nvar RotatingFileStream = null;\nif (mv) {\n  RotatingFileStream = function RotatingFileStream(options) {\n    this.path = options.path;\n    this.count = options.count == null ? 10 : options.count;\n    assert.equal(typeof this.count, 'number', format('rotating-file stream \"count\" is not a number: %j (%s) in %j', this.count, typeof this.count, this));\n    assert.ok(this.count >= 0, format('rotating-file stream \"count\" is not >= 0: %j in %j', this.count, this));\n\n    // Parse `options.period`.\n    if (options.period) {\n      // <number><scope> where scope is:\n      //    h   hours (at the start of the hour)\n      //    d   days (at the start of the day, i.e. just after midnight)\n      //    w   weeks (at the start of Sunday)\n      //    m   months (on the first of the month)\n      //    y   years (at the start of Jan 1st)\n      // with special values 'hourly' (1h), 'daily' (1d), \"weekly\" (1w),\n      // 'monthly' (1m) and 'yearly' (1y)\n      var period = {\n        'hourly': '1h',\n        'daily': '1d',\n        'weekly': '1w',\n        'monthly': '1m',\n        'yearly': '1y'\n      }[options.period] || options.period;\n      var m = /^([1-9][0-9]*)([hdwmy]|ms)$/.exec(period);\n      if (!m) {\n        throw new Error(format('invalid period: \"%s\"', options.period));\n      }\n      this.periodNum = Number(m[1]);\n      this.periodScope = m[2];\n    } else {\n      this.periodNum = 1;\n      this.periodScope = 'd';\n    }\n    var lastModified = null;\n    try {\n      var fileInfo = fs.statSync(this.path);\n      lastModified = fileInfo.mtime.getTime();\n    } catch (err) {\n      // file doesn't exist\n    }\n    var rotateAfterOpen = false;\n    if (lastModified) {\n      var lastRotTime = this._calcRotTime(0);\n      if (lastModified < lastRotTime) {\n        rotateAfterOpen = true;\n      }\n    }\n\n    // TODO: template support for backup files\n    // template: <path to which to rotate>\n    //      default is %P.%n\n    //      '/var/log/archive/foo.log'  -> foo.log.%n\n    //      '/var/log/archive/foo.log.%n'\n    //      codes:\n    //          XXX support strftime codes (per node version of those)\n    //              or whatever module. Pick non-colliding for extra\n    //              codes\n    //          %P      `path` base value\n    //          %n      integer number of rotated log (1,2,3,...)\n    //          %d      datetime in YYYY-MM-DD_HH-MM-SS\n    //                      XXX what should default date format be?\n    //                          prior art? Want to avoid ':' in\n    //                          filenames (illegal on Windows for one).\n\n    this.stream = fs.createWriteStream(this.path, {\n      flags: 'a',\n      encoding: 'utf8'\n    });\n    this.rotQueue = [];\n    this.rotating = false;\n    if (rotateAfterOpen) {\n      this._debug('rotateAfterOpen -> call rotate()');\n      this.rotate();\n    } else {\n      this._setupNextRot();\n    }\n  };\n  util.inherits(RotatingFileStream, EventEmitter);\n  RotatingFileStream.prototype._debug = function () {\n    // Set this to `true` to add debug logging.\n    if (false) {\n      if (arguments.length === 0) {\n        return true;\n      }\n      var args = Array.prototype.slice.call(arguments);\n      args[0] = '[' + new Date().toISOString() + ', ' + this.path + '] ' + args[0];\n      console.log.apply(this, args);\n    } else {\n      return false;\n    }\n  };\n  RotatingFileStream.prototype._setupNextRot = function () {\n    this.rotAt = this._calcRotTime(1);\n    this._setRotationTimer();\n  };\n  RotatingFileStream.prototype._setRotationTimer = function () {\n    var self = this;\n    var delay = this.rotAt - Date.now();\n    // Cap timeout to Node's max setTimeout, see\n    // <https://github.com/joyent/node/issues/8656>.\n    var TIMEOUT_MAX = 2147483647; // 2^31-1\n    if (delay > TIMEOUT_MAX) {\n      delay = TIMEOUT_MAX;\n    }\n    this.timeout = setTimeout(function () {\n      self._debug('_setRotationTimer timeout -> call rotate()');\n      self.rotate();\n    }, delay);\n    if (typeof this.timeout.unref === 'function') {\n      this.timeout.unref();\n    }\n  };\n  RotatingFileStream.prototype._calcRotTime = function _calcRotTime(periodOffset) {\n    this._debug('_calcRotTime: %s%s', this.periodNum, this.periodScope);\n    var d = new Date();\n    this._debug('  now local: %s', d);\n    this._debug('    now utc: %s', d.toISOString());\n    var rotAt;\n    switch (this.periodScope) {\n      case 'ms':\n        // Hidden millisecond period for debugging.\n        if (this.rotAt) {\n          rotAt = this.rotAt + this.periodNum * periodOffset;\n        } else {\n          rotAt = Date.now() + this.periodNum * periodOffset;\n        }\n        break;\n      case 'h':\n        if (this.rotAt) {\n          rotAt = this.rotAt + this.periodNum * 60 * 60 * 1000 * periodOffset;\n        } else {\n          // First time: top of the next hour.\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate(), d.getUTCHours() + periodOffset);\n        }\n        break;\n      case 'd':\n        if (this.rotAt) {\n          rotAt = this.rotAt + this.periodNum * 24 * 60 * 60 * 1000 * periodOffset;\n        } else {\n          // First time: start of tomorrow (i.e. at the coming midnight) UTC.\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate() + periodOffset);\n        }\n        break;\n      case 'w':\n        // Currently, always on Sunday morning at 00:00:00 (UTC).\n        if (this.rotAt) {\n          rotAt = this.rotAt + this.periodNum * 7 * 24 * 60 * 60 * 1000 * periodOffset;\n        } else {\n          // First time: this coming Sunday.\n          var dayOffset = 7 - d.getUTCDay();\n          if (periodOffset < 1) {\n            dayOffset = -d.getUTCDay();\n          }\n          if (periodOffset > 1 || periodOffset < -1) {\n            dayOffset += 7 * periodOffset;\n          }\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate() + dayOffset);\n        }\n        break;\n      case 'm':\n        if (this.rotAt) {\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth() + this.periodNum * periodOffset, 1);\n        } else {\n          // First time: the start of the next month.\n          rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth() + periodOffset, 1);\n        }\n        break;\n      case 'y':\n        if (this.rotAt) {\n          rotAt = Date.UTC(d.getUTCFullYear() + this.periodNum * periodOffset, 0, 1);\n        } else {\n          // First time: the start of the next year.\n          rotAt = Date.UTC(d.getUTCFullYear() + periodOffset, 0, 1);\n        }\n        break;\n      default:\n        assert.fail(format('invalid period scope: \"%s\"', this.periodScope));\n    }\n    if (this._debug()) {\n      this._debug('  **rotAt**: %s (utc: %s)', rotAt, new Date(rotAt).toUTCString());\n      var now = Date.now();\n      this._debug('        now: %s (%sms == %smin == %sh to go)', now, rotAt - now, (rotAt - now) / 1000 / 60, (rotAt - now) / 1000 / 60 / 60);\n    }\n    return rotAt;\n  };\n  RotatingFileStream.prototype.rotate = function rotate() {\n    // XXX What about shutdown?\n    var self = this;\n\n    // If rotation period is > ~25 days, we have to break into multiple\n    // setTimeout's. See <https://github.com/joyent/node/issues/8656>.\n    if (self.rotAt && self.rotAt > Date.now()) {\n      return self._setRotationTimer();\n    }\n    this._debug('rotate');\n    if (self.rotating) {\n      throw new TypeError('cannot start a rotation when already rotating');\n    }\n    self.rotating = true;\n    self.stream.end(); // XXX can do moves sync after this? test at high rate\n\n    function del() {\n      var toDel = self.path + '.' + String(n - 1);\n      if (n === 0) {\n        toDel = self.path;\n      }\n      n -= 1;\n      self._debug('  rm %s', toDel);\n      fs.unlink(toDel, function (delErr) {\n        //XXX handle err other than not exists\n        moves();\n      });\n    }\n    function moves() {\n      if (self.count === 0 || n < 0) {\n        return finish();\n      }\n      var before = self.path;\n      var after = self.path + '.' + String(n);\n      if (n > 0) {\n        before += '.' + String(n - 1);\n      }\n      n -= 1;\n      fs.exists(before, function (exists) {\n        if (!exists) {\n          moves();\n        } else {\n          self._debug('  mv %s %s', before, after);\n          mv(before, after, function (mvErr) {\n            if (mvErr) {\n              self.emit('error', mvErr);\n              finish(); // XXX finish here?\n            } else {\n              moves();\n            }\n          });\n        }\n      });\n    }\n    function finish() {\n      self._debug('  open %s', self.path);\n      self.stream = fs.createWriteStream(self.path, {\n        flags: 'a',\n        encoding: 'utf8'\n      });\n      var q = self.rotQueue,\n        len = q.length;\n      for (var i = 0; i < len; i++) {\n        self.stream.write(q[i]);\n      }\n      self.rotQueue = [];\n      self.rotating = false;\n      self.emit('drain');\n      self._setupNextRot();\n    }\n    var n = this.count;\n    del();\n  };\n  RotatingFileStream.prototype.write = function write(s) {\n    if (this.rotating) {\n      this.rotQueue.push(s);\n      return false;\n    } else {\n      return this.stream.write(s);\n    }\n  };\n  RotatingFileStream.prototype.end = function end(s) {\n    this.stream.end();\n  };\n  RotatingFileStream.prototype.destroy = function destroy(s) {\n    this.stream.destroy();\n  };\n  RotatingFileStream.prototype.destroySoon = function destroySoon(s) {\n    this.stream.destroySoon();\n  };\n} /* if (mv) */\n\n/**\n * RingBuffer is a Writable Stream that just stores the last N records in\n * memory.\n *\n * @param options {Object}, with the following fields:\n *\n *    - limit: number of records to keep in memory\n */\nfunction RingBuffer(options) {\n  this.limit = options && options.limit ? options.limit : 100;\n  this.writable = true;\n  this.records = [];\n  EventEmitter.call(this);\n}\nutil.inherits(RingBuffer, EventEmitter);\nRingBuffer.prototype.write = function (record) {\n  if (!this.writable) throw new Error('RingBuffer has been ended already');\n  this.records.push(record);\n  if (this.records.length > this.limit) this.records.shift();\n  return true;\n};\nRingBuffer.prototype.end = function () {\n  if (arguments.length > 0) this.write.apply(this, Array.prototype.slice.call(arguments));\n  this.writable = false;\n};\nRingBuffer.prototype.destroy = function () {\n  this.writable = false;\n  this.emit('close');\n};\nRingBuffer.prototype.destroySoon = function () {\n  this.destroy();\n};\n\n//---- Exports\n\nmodule.exports = Logger;\nmodule.exports.TRACE = TRACE;\nmodule.exports.DEBUG = DEBUG;\nmodule.exports.INFO = INFO;\nmodule.exports.WARN = WARN;\nmodule.exports.ERROR = ERROR;\nmodule.exports.FATAL = FATAL;\nmodule.exports.resolveLevel = resolveLevel;\nmodule.exports.levelFromName = levelFromName;\nmodule.exports.nameFromLevel = nameFromLevel;\nmodule.exports.VERSION = VERSION;\nmodule.exports.LOG_VERSION = LOG_VERSION;\nmodule.exports.createLogger = function createLogger(options) {\n  return new Logger(options);\n};\nmodule.exports.RingBuffer = RingBuffer;\nmodule.exports.RotatingFileStream = RotatingFileStream;\n\n// Useful for custom `type == 'raw'` streams that may do JSON stringification\n// of log records themselves. Usage:\n//    var str = JSON.stringify(rec, bunyan.safeCycles());\nmodule.exports.safeCycles = safeCycles;","map":{"version":3,"names":["VERSION","LOG_VERSION","xxx","s","args","concat","Array","prototype","slice","call","arguments","console","error","apply","runtimeEnv","process","versions","nw","node","window","Error","os","fs","dtrace","hostname","location","host","require","e","util","assert","EventEmitter","stream","safeJsonStringify","env","BUNYAN_TEST_NO_SAFE_JSON_STRINGIFY","mv","sourceMapSupport","_","objCopy","obj","isArray","copy","Object","keys","forEach","k","format","inspect","formatRegExp","f","objects","i","length","push","join","len","str","String","replace","x","Number","fastAndSafeJsonStringify","getCaller3Info","undefined","saveLimit","stackTraceLimit","savePrepare","prepareStackTrace","stack","caller","wrapCallSite","file","getFileName","line","getLineNumber","func","getFunctionName","captureStackTrace","_indent","indent","lines","split","_warn","msg","dedupKey","ok","_warned","stderr","write","_haveWarned","ConsoleRawStream","rec","level","INFO","log","WARN","info","ERROR","warn","TRACE","DEBUG","FATAL","levelFromName","nameFromLevel","name","dtp","probes","resolveLevel","nameOrNum","type","toLowerCase","TypeError","Math","floor","isWritable","Writable","Logger","options","_childOptions","_childSimple","parent","streams","serializers","_isSimpleChild","_level","src","fields","parentFieldNames","names","self","closeOnExit","POSITIVE_INFINITY","createDTraceProvider","probe","addProbe","enable","addStream","stdout","addSerializers","_applySerializers","pid","inherits","defaultLevel","path","raw","reemitErrorEvents","createWriteStream","flags","encoding","RotatingFileStream","on","onStreamError","err","emit","haveNonRawStreams","field","serializer","child","simple","constructor","reopenFileStreams","end","destroySoon","value","newLevel","levels","equal","map","excludeFields","_emit","noemit","EOL","mkRecord","minLevel","msgArgs","stdSerializers","message","Buffer","isBuffer","recFields","time","Date","v","mkProbeArgs","mkLogEmitter","fire","trace","debug","fatal","req","connection","method","url","originalUrl","headers","remoteAddress","remotePort","res","statusCode","header","_header","getFullErrorStack","ex","ret","toString","cause","cex","errSerializer","code","signal","safeCyclesSet","seen","Set","key","val","has","add","safeCyclesArray","indexOf","safeCycles","JSON","stringify","count","period","m","exec","periodNum","periodScope","lastModified","fileInfo","statSync","mtime","getTime","rotateAfterOpen","lastRotTime","_calcRotTime","rotQueue","rotating","_debug","rotate","_setupNextRot","toISOString","rotAt","_setRotationTimer","delay","now","TIMEOUT_MAX","timeout","setTimeout","unref","periodOffset","d","UTC","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","dayOffset","getUTCDay","fail","toUTCString","del","toDel","n","unlink","delErr","moves","finish","before","after","exists","mvErr","q","destroy","RingBuffer","limit","writable","records","record","shift","module","exports","createLogger"],"sources":["/Users/petarjukic/Documents/Kriptovalute/Projekt/BlockExplorer/block_explorer/node_modules/bunyan/lib/bunyan.js"],"sourcesContent":["/**\n * Copyright 2021 Trent Mick.\n * Copyright 2020 Joyent Inc.\n *\n * The bunyan logging library for node.js.\n *\n * -*- mode: js -*-\n * vim: expandtab:ts=4:sw=4\n */\n\nvar VERSION = '1.8.15';\n\n/*\n * Bunyan log format version. This becomes the 'v' field on all log records.\n * This will be incremented if there is any backward incompatible change to\n * the log record format. Details will be in 'CHANGES.md' (the change log).\n */\nvar LOG_VERSION = 0;\n\n\nvar xxx = function xxx(s) {     // internal dev/debug logging\n    var args = ['XX' + 'X: '+s].concat(\n        Array.prototype.slice.call(arguments, 1));\n    console.error.apply(this, args);\n};\nvar xxx = function xxx() {};  // comment out to turn on debug logging\n\n\n/*\n * Runtime environment notes:\n *\n * Bunyan is intended to run in a number of runtime environments. Here are\n * some notes on differences for those envs and how the code copes.\n *\n * - node.js: The primary target environment.\n * - NW.js: http://nwjs.io/  An *app* environment that feels like both a\n *   node env -- it has node-like globals (`process`, `global`) and\n *   browser-like globals (`window`, `navigator`). My *understanding* is that\n *   bunyan can operate as if this is vanilla node.js.\n * - browser: Failing the above, we sniff using the `window` global\n *   <https://developer.mozilla.org/en-US/docs/Web/API/Window/window>.\n *      - browserify: http://browserify.org/  A browser-targetting bundler of\n *        node.js deps. The runtime is a browser env, so can't use fs access,\n *        etc. Browserify's build looks for `require(<single-string>)` imports\n *        to bundle. For some imports it won't be able to handle, we \"hide\"\n *        from browserify with `require('frobshizzle' + '')`.\n * - Other? Please open issues if things are broken.\n */\nvar runtimeEnv;\nif (typeof (process) !== 'undefined' && process.versions) {\n    if (process.versions.nw) {\n        runtimeEnv = 'nw';\n    } else if (process.versions.node) {\n        runtimeEnv = 'node';\n    }\n}\nif (!runtimeEnv && typeof (window) !== 'undefined' &&\n    window.window === window) {\n    runtimeEnv = 'browser';\n}\nif (!runtimeEnv) {\n    throw new Error('unknown runtime environment');\n}\n\n\nvar os, fs, dtrace;\nif (runtimeEnv === 'browser') {\n    os = {\n        hostname: function () {\n            return window.location.host;\n        }\n    };\n    fs = {};\n    dtrace = null;\n} else {\n    os = require('os');\n    fs = require('fs');\n    try {\n        dtrace = require('dtrace-provider' + '');\n    } catch (e) {\n        dtrace = null;\n    }\n}\nvar util = require('util');\nvar assert = require('assert');\nvar EventEmitter = require('events').EventEmitter;\nvar stream = require('stream');\n\ntry {\n    var safeJsonStringify = require('safe-json-stringify');\n} catch (e) {\n    safeJsonStringify = null;\n}\nif (process.env.BUNYAN_TEST_NO_SAFE_JSON_STRINGIFY) {\n    safeJsonStringify = null;\n}\n\n// The 'mv' module is required for rotating-file stream support.\ntry {\n    var mv = require('mv' + '');\n} catch (e) {\n    mv = null;\n}\n\ntry {\n    var sourceMapSupport = require('source-map-support' + '');\n} catch (_) {\n    sourceMapSupport = null;\n}\n\n\n//---- Internal support stuff\n\n/**\n * A shallow copy of an object. Bunyan logging attempts to never cause\n * exceptions, so this function attempts to handle non-objects gracefully.\n */\nfunction objCopy(obj) {\n    if (obj == null) {  // null or undefined\n        return obj;\n    } else if (Array.isArray(obj)) {\n        return obj.slice();\n    } else if (typeof (obj) === 'object') {\n        var copy = {};\n        Object.keys(obj).forEach(function (k) {\n            copy[k] = obj[k];\n        });\n        return copy;\n    } else {\n        return obj;\n    }\n}\n\nvar format = util.format;\nif (!format) {\n    // If node < 0.6, then use its `util.format`:\n    // <https://github.com/joyent/node/blob/master/lib/util.js#L22>:\n    var inspect = util.inspect;\n    var formatRegExp = /%[sdj%]/g;\n    format = function format(f) {\n        if (typeof (f) !== 'string') {\n            var objects = [];\n            for (var i = 0; i < arguments.length; i++) {\n                objects.push(inspect(arguments[i]));\n            }\n            return objects.join(' ');\n        }\n\n        var i = 1;\n        var args = arguments;\n        var len = args.length;\n        var str = String(f).replace(formatRegExp, function (x) {\n            if (i >= len)\n                return x;\n            switch (x) {\n                case '%s': return String(args[i++]);\n                case '%d': return Number(args[i++]);\n                case '%j': return fastAndSafeJsonStringify(args[i++]);\n                case '%%': return '%';\n                default:\n                    return x;\n            }\n        });\n        for (var x = args[i]; i < len; x = args[++i]) {\n            if (x === null || typeof (x) !== 'object') {\n                str += ' ' + x;\n            } else {\n                str += ' ' + inspect(x);\n            }\n        }\n        return str;\n    };\n}\n\n\n/**\n * Gather some caller info 3 stack levels up.\n * See <http://code.google.com/p/v8/wiki/JavaScriptStackTraceApi>.\n */\nfunction getCaller3Info() {\n    if (this === undefined) {\n        // Cannot access caller info in 'strict' mode.\n        return;\n    }\n    var obj = {};\n    var saveLimit = Error.stackTraceLimit;\n    var savePrepare = Error.prepareStackTrace;\n    Error.stackTraceLimit = 3;\n\n    Error.prepareStackTrace = function (_, stack) {\n        var caller = stack[2];\n        if (sourceMapSupport) {\n            caller = sourceMapSupport.wrapCallSite(caller);\n        }\n        obj.file = caller.getFileName();\n        obj.line = caller.getLineNumber();\n        var func = caller.getFunctionName();\n        if (func)\n            obj.func = func;\n    };\n    Error.captureStackTrace(this, getCaller3Info);\n    this.stack;\n\n    Error.stackTraceLimit = saveLimit;\n    Error.prepareStackTrace = savePrepare;\n    return obj;\n}\n\n\nfunction _indent(s, indent) {\n    if (!indent) indent = '    ';\n    var lines = s.split(/\\r?\\n/g);\n    return indent + lines.join('\\n' + indent);\n}\n\n\n/**\n * Warn about an bunyan processing error.\n *\n * @param msg {String} Message with which to warn.\n * @param dedupKey {String} Optional. A short string key for this warning to\n *      have its warning only printed once.\n */\nfunction _warn(msg, dedupKey) {\n    assert.ok(msg);\n    if (dedupKey) {\n        if (_warned[dedupKey]) {\n            return;\n        }\n        _warned[dedupKey] = true;\n    }\n    process.stderr.write(msg + '\\n');\n}\nfunction _haveWarned(dedupKey) {\n    return _warned[dedupKey];\n}\nvar _warned = {};\n\n\nfunction ConsoleRawStream() {}\nConsoleRawStream.prototype.write = function (rec) {\n    if (rec.level < INFO) {\n        console.log(rec);\n    } else if (rec.level < WARN) {\n        console.info(rec);\n    } else if (rec.level < ERROR) {\n        console.warn(rec);\n    } else {\n        console.error(rec);\n    }\n};\n\n\n//---- Levels\n\nvar TRACE = 10;\nvar DEBUG = 20;\nvar INFO = 30;\nvar WARN = 40;\nvar ERROR = 50;\nvar FATAL = 60;\n\nvar levelFromName = {\n    'trace': TRACE,\n    'debug': DEBUG,\n    'info': INFO,\n    'warn': WARN,\n    'error': ERROR,\n    'fatal': FATAL\n};\nvar nameFromLevel = {};\nObject.keys(levelFromName).forEach(function (name) {\n    nameFromLevel[levelFromName[name]] = name;\n});\n\n// Dtrace probes.\nvar dtp = undefined;\nvar probes = dtrace && {};\n\n/**\n * Resolve a level number, name (upper or lowercase) to a level number value.\n *\n * @param nameOrNum {String|Number} A level name (case-insensitive) or positive\n *      integer level.\n * @api public\n */\nfunction resolveLevel(nameOrNum) {\n    var level;\n    var type = typeof (nameOrNum);\n    if (type === 'string') {\n        level = levelFromName[nameOrNum.toLowerCase()];\n        if (!level) {\n            throw new Error(format('unknown level name: \"%s\"', nameOrNum));\n        }\n    } else if (type !== 'number') {\n        throw new TypeError(format('cannot resolve level: invalid arg (%s):',\n            type, nameOrNum));\n    } else if (nameOrNum < 0 || Math.floor(nameOrNum) !== nameOrNum) {\n        throw new TypeError(format('level is not a positive integer: %s',\n            nameOrNum));\n    } else {\n        level = nameOrNum;\n    }\n    return level;\n}\n\n\nfunction isWritable(obj) {\n    if (obj instanceof stream.Writable) {\n        return true;\n    }\n    return typeof (obj.write) === 'function';\n}\n\n\n//---- Logger class\n\n/**\n * Create a Logger instance.\n *\n * @param options {Object} See documentation for full details. At minimum\n *    this must include a 'name' string key. Configuration keys:\n *      - `streams`: specify the logger output streams. This is an array of\n *        objects with these fields:\n *          - `type`: The stream type. See README.md for full details.\n *            Often this is implied by the other fields. Examples are\n *            'file', 'stream' and \"raw\".\n *          - `level`: Defaults to 'info'.\n *          - `path` or `stream`: The specify the file path or writeable\n *            stream to which log records are written. E.g.\n *            `stream: process.stdout`.\n *          - `closeOnExit` (boolean): Optional. Default is true for a\n *            'file' stream when `path` is given, false otherwise.\n *        See README.md for full details.\n *      - `level`: set the level for a single output stream (cannot be used\n *        with `streams`)\n *      - `stream`: the output stream for a logger with just one, e.g.\n *        `process.stdout` (cannot be used with `streams`)\n *      - `serializers`: object mapping log record field names to\n *        serializing functions. See README.md for details.\n *      - `src`: Boolean (default false). Set true to enable 'src' automatic\n *        field with log call source info.\n *    All other keys are log record fields.\n *\n * An alternative *internal* call signature is used for creating a child:\n *    new Logger(<parent logger>, <child options>[, <child opts are simple>]);\n *\n * @param _childSimple (Boolean) An assertion that the given `_childOptions`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation.\n */\nfunction Logger(options, _childOptions, _childSimple) {\n    xxx('Logger start:', options)\n    if (!(this instanceof Logger)) {\n        return new Logger(options, _childOptions);\n    }\n\n    // Input arg validation.\n    var parent;\n    if (_childOptions !== undefined) {\n        parent = options;\n        options = _childOptions;\n        if (!(parent instanceof Logger)) {\n            throw new TypeError(\n                'invalid Logger creation: do not pass a second arg');\n        }\n    }\n    if (!options) {\n        throw new TypeError('options (object) is required');\n    }\n    if (!parent) {\n        if (!options.name) {\n            throw new TypeError('options.name (string) is required');\n        }\n    } else {\n        if (options.name) {\n            throw new TypeError(\n                'invalid options.name: child cannot set logger name');\n        }\n    }\n    if (options.stream && options.streams) {\n        throw new TypeError('cannot mix \"streams\" and \"stream\" options');\n    }\n    if (options.streams && !Array.isArray(options.streams)) {\n        throw new TypeError('invalid options.streams: must be an array')\n    }\n    if (options.serializers && (typeof (options.serializers) !== 'object' ||\n            Array.isArray(options.serializers))) {\n        throw new TypeError('invalid options.serializers: must be an object')\n    }\n\n    EventEmitter.call(this);\n\n    // Fast path for simple child creation.\n    if (parent && _childSimple) {\n        // `_isSimpleChild` is a signal to stream close handling that this child\n        // owns none of its streams.\n        this._isSimpleChild = true;\n\n        this._level = parent._level;\n        this.streams = parent.streams;\n        this.serializers = parent.serializers;\n        this.src = parent.src;\n        var fields = this.fields = {};\n        var parentFieldNames = Object.keys(parent.fields);\n        for (var i = 0; i < parentFieldNames.length; i++) {\n            var name = parentFieldNames[i];\n            fields[name] = parent.fields[name];\n        }\n        var names = Object.keys(options);\n        for (var i = 0; i < names.length; i++) {\n            var name = names[i];\n            fields[name] = options[name];\n        }\n        return;\n    }\n\n    // Start values.\n    var self = this;\n    if (parent) {\n        this._level = parent._level;\n        this.streams = [];\n        for (var i = 0; i < parent.streams.length; i++) {\n            var s = objCopy(parent.streams[i]);\n            s.closeOnExit = false; // Don't own parent stream.\n            this.streams.push(s);\n        }\n        this.serializers = objCopy(parent.serializers);\n        this.src = parent.src;\n        this.fields = objCopy(parent.fields);\n        if (options.level) {\n            this.level(options.level);\n        }\n    } else {\n        this._level = Number.POSITIVE_INFINITY;\n        this.streams = [];\n        this.serializers = null;\n        this.src = false;\n        this.fields = {};\n    }\n\n    if (!dtp && dtrace) {\n        dtp = dtrace.createDTraceProvider('bunyan');\n\n        for (var level in levelFromName) {\n            var probe;\n\n            probes[levelFromName[level]] = probe =\n                dtp.addProbe('log-' + level, 'char *');\n\n            // Explicitly add a reference to dtp to prevent it from being GC'd\n            probe.dtp = dtp;\n        }\n\n        dtp.enable();\n    }\n\n    // Handle *config* options (i.e. options that are not just plain data\n    // for log records).\n    if (options.stream) {\n        self.addStream({\n            type: 'stream',\n            stream: options.stream,\n            closeOnExit: false,\n            level: options.level\n        });\n    } else if (options.streams) {\n        options.streams.forEach(function (s) {\n            self.addStream(s, options.level);\n        });\n    } else if (parent && options.level) {\n        this.level(options.level);\n    } else if (!parent) {\n        if (runtimeEnv === 'browser') {\n            /*\n             * In the browser we'll be emitting to console.log by default.\n             * Any console.log worth its salt these days can nicely render\n             * and introspect objects (e.g. the Firefox and Chrome console)\n             * so let's emit the raw log record. Are there browsers for which\n             * that breaks things?\n             */\n            self.addStream({\n                type: 'raw',\n                stream: new ConsoleRawStream(),\n                closeOnExit: false,\n                level: options.level\n            });\n        } else {\n            self.addStream({\n                type: 'stream',\n                stream: process.stdout,\n                closeOnExit: false,\n                level: options.level\n            });\n        }\n    }\n    if (options.serializers) {\n        self.addSerializers(options.serializers);\n    }\n    if (options.src) {\n        this.src = true;\n    }\n    xxx('Logger: ', self)\n\n    // Fields.\n    // These are the default fields for log records (minus the attributes\n    // removed in this constructor). To allow storing raw log records\n    // (unrendered), `this.fields` must never be mutated. Create a copy for\n    // any changes.\n    var fields = objCopy(options);\n    delete fields.stream;\n    delete fields.level;\n    delete fields.streams;\n    delete fields.serializers;\n    delete fields.src;\n    if (this.serializers) {\n        this._applySerializers(fields);\n    }\n    if (!fields.hostname && !self.fields.hostname) {\n        fields.hostname = os.hostname();\n    }\n    if (!fields.pid) {\n        fields.pid = process.pid;\n    }\n    Object.keys(fields).forEach(function (k) {\n        self.fields[k] = fields[k];\n    });\n}\n\nutil.inherits(Logger, EventEmitter);\n\n\n/**\n * Add a stream\n *\n * @param stream {Object}. Object with these fields:\n *    - `type`: The stream type. See README.md for full details.\n *      Often this is implied by the other fields. Examples are\n *      'file', 'stream' and \"raw\".\n *    - `path` or `stream`: The specify the file path or writeable\n *      stream to which log records are written. E.g.\n *      `stream: process.stdout`.\n *    - `level`: Optional. Falls back to `defaultLevel`.\n *    - `closeOnExit` (boolean): Optional. Default is true for a\n *      'file' stream when `path` is given, false otherwise.\n *    See README.md for full details.\n * @param defaultLevel {Number|String} Optional. A level to use if\n *      `stream.level` is not set. If neither is given, this defaults to INFO.\n */\nLogger.prototype.addStream = function addStream(s, defaultLevel) {\n    var self = this;\n    if (defaultLevel === null || defaultLevel === undefined) {\n        defaultLevel = INFO;\n    }\n\n    s = objCopy(s);\n\n    // Implicit 'type' from other args.\n    if (!s.type) {\n        if (s.stream) {\n            s.type = 'stream';\n        } else if (s.path) {\n            s.type = 'file'\n        }\n    }\n    s.raw = (s.type === 'raw');  // PERF: Allow for faster check in `_emit`.\n\n    if (s.level !== undefined) {\n        s.level = resolveLevel(s.level);\n    } else {\n        s.level = resolveLevel(defaultLevel);\n    }\n    if (s.level < self._level) {\n        self._level = s.level;\n    }\n\n    switch (s.type) {\n    case 'stream':\n        assert.ok(isWritable(s.stream),\n                  '\"stream\" stream is not writable: ' + util.inspect(s.stream));\n\n        if (!s.closeOnExit) {\n            s.closeOnExit = false;\n        }\n        break;\n    case 'file':\n        if (s.reemitErrorEvents === undefined) {\n            s.reemitErrorEvents = true;\n        }\n        if (!s.stream) {\n            s.stream = fs.createWriteStream(s.path,\n                                            {flags: 'a', encoding: 'utf8'});\n            if (!s.closeOnExit) {\n                s.closeOnExit = true;\n            }\n        } else {\n            if (!s.closeOnExit) {\n                s.closeOnExit = false;\n            }\n        }\n        break;\n    case 'rotating-file':\n        assert.ok(!s.stream,\n                  '\"rotating-file\" stream should not give a \"stream\"');\n        assert.ok(s.path);\n        assert.ok(mv, '\"rotating-file\" stream type is not supported: '\n                      + 'missing \"mv\" module');\n        s.stream = new RotatingFileStream(s);\n        if (!s.closeOnExit) {\n            s.closeOnExit = true;\n        }\n        break;\n    case 'raw':\n        if (!s.closeOnExit) {\n            s.closeOnExit = false;\n        }\n        break;\n    default:\n        throw new TypeError('unknown stream type \"' + s.type + '\"');\n    }\n\n    if (s.reemitErrorEvents && typeof (s.stream.on) === 'function') {\n        // TODO: When we have `<logger>.close()`, it should remove event\n        //      listeners to not leak Logger instances.\n        s.stream.on('error', function onStreamError(err) {\n            self.emit('error', err, s);\n        });\n    }\n\n    self.streams.push(s);\n    delete self.haveNonRawStreams;  // reset\n}\n\n\n/**\n * Add serializers\n *\n * @param serializers {Object} Optional. Object mapping log record field names\n *    to serializing functions. See README.md for details.\n */\nLogger.prototype.addSerializers = function addSerializers(serializers) {\n    var self = this;\n\n    if (!self.serializers) {\n        self.serializers = {};\n    }\n    Object.keys(serializers).forEach(function (field) {\n        var serializer = serializers[field];\n        if (typeof (serializer) !== 'function') {\n            throw new TypeError(format(\n                'invalid serializer for \"%s\" field: must be a function',\n                field));\n        } else {\n            self.serializers[field] = serializer;\n        }\n    });\n}\n\n\n\n/**\n * Create a child logger, typically to add a few log record fields.\n *\n * This can be useful when passing a logger to a sub-component, e.g. a\n * 'wuzzle' component of your service:\n *\n *    var wuzzleLog = log.child({component: 'wuzzle'})\n *    var wuzzle = new Wuzzle({..., log: wuzzleLog})\n *\n * Then log records from the wuzzle code will have the same structure as\n * the app log, *plus the component='wuzzle' field*.\n *\n * @param options {Object} Optional. Set of options to apply to the child.\n *    All of the same options for a new Logger apply here. Notes:\n *      - The parent's streams are inherited and cannot be removed in this\n *        call. Any given `streams` are *added* to the set inherited from\n *        the parent.\n *      - The parent's serializers are inherited, though can effectively be\n *        overwritten by using duplicate keys.\n *      - Can use `level` to set the level of the streams inherited from\n *        the parent. The level for the parent is NOT affected.\n * @param simple {Boolean} Optional. Set to true to assert that `options`\n *    (a) only add fields (no config) and (b) no serialization handling is\n *    required for them. IOW, this is a fast path for frequent child\n *    creation. See 'tools/timechild.js' for numbers.\n */\nLogger.prototype.child = function (options, simple) {\n    return new (this.constructor)(this, options || {}, simple);\n}\n\n\n/**\n * A convenience method to reopen 'file' streams on a logger. This can be\n * useful with external log rotation utilities that move and re-open log files\n * (e.g. logrotate on Linux, logadm on SmartOS/Illumos). Those utilities\n * typically have rotation options to copy-and-truncate the log file, but\n * you may not want to use that. An alternative is to do this in your\n * application:\n *\n *      var log = bunyan.createLogger(...);\n *      ...\n *      process.on('SIGUSR2', function () {\n *          log.reopenFileStreams();\n *      });\n *      ...\n *\n * See <https://github.com/trentm/node-bunyan/issues/104>.\n */\nLogger.prototype.reopenFileStreams = function () {\n    var self = this;\n    self.streams.forEach(function (s) {\n        if (s.type === 'file') {\n            if (s.stream) {\n                // Not sure if typically would want this, or more immediate\n                // `s.stream.destroy()`.\n                s.stream.end();\n                s.stream.destroySoon();\n                delete s.stream;\n            }\n            s.stream = fs.createWriteStream(s.path,\n                {flags: 'a', encoding: 'utf8'});\n            s.stream.on('error', function (err) {\n                self.emit('error', err, s);\n            });\n        }\n    });\n};\n\n\n/* BEGIN JSSTYLED */\n/**\n * Close this logger.\n *\n * This closes streams (that it owns, as per 'endOnClose' attributes on\n * streams), etc. Typically you **don't** need to bother calling this.\nLogger.prototype.close = function () {\n    if (this._closed) {\n        return;\n    }\n    if (!this._isSimpleChild) {\n        self.streams.forEach(function (s) {\n            if (s.endOnClose) {\n                xxx('closing stream s:', s);\n                s.stream.end();\n                s.endOnClose = false;\n            }\n        });\n    }\n    this._closed = true;\n}\n */\n/* END JSSTYLED */\n\n\n/**\n * Get/set the level of all streams on this logger.\n *\n * Get Usage:\n *    // Returns the current log level (lowest level of all its streams).\n *    log.level() -> INFO\n *\n * Set Usage:\n *    log.level(INFO)       // set all streams to level INFO\n *    log.level('info')     // can use 'info' et al aliases\n */\nLogger.prototype.level = function level(value) {\n    if (value === undefined) {\n        return this._level;\n    }\n    var newLevel = resolveLevel(value);\n    var len = this.streams.length;\n    for (var i = 0; i < len; i++) {\n        this.streams[i].level = newLevel;\n    }\n    this._level = newLevel;\n}\n\n\n/**\n * Get/set the level of a particular stream on this logger.\n *\n * Get Usage:\n *    // Returns an array of the levels of each stream.\n *    log.levels() -> [TRACE, INFO]\n *\n *    // Returns a level of the identified stream.\n *    log.levels(0) -> TRACE      // level of stream at index 0\n *    log.levels('foo')           // level of stream with name 'foo'\n *\n * Set Usage:\n *    log.levels(0, INFO)         // set level of stream 0 to INFO\n *    log.levels(0, 'info')       // can use 'info' et al aliases\n *    log.levels('foo', WARN)     // set stream named 'foo' to WARN\n *\n * Stream names: When streams are defined, they can optionally be given\n * a name. For example,\n *       log = new Logger({\n *         streams: [\n *           {\n *             name: 'foo',\n *             path: '/var/log/my-service/foo.log'\n *             level: 'trace'\n *           },\n *         ...\n *\n * @param name {String|Number} The stream index or name.\n * @param value {Number|String} The level value (INFO) or alias ('info').\n *    If not given, this is a 'get' operation.\n * @throws {Error} If there is no stream with the given name.\n */\nLogger.prototype.levels = function levels(name, value) {\n    if (name === undefined) {\n        assert.equal(value, undefined);\n        return this.streams.map(\n            function (s) { return s.level });\n    }\n    var stream;\n    if (typeof (name) === 'number') {\n        stream = this.streams[name];\n        if (stream === undefined) {\n            throw new Error('invalid stream index: ' + name);\n        }\n    } else {\n        var len = this.streams.length;\n        for (var i = 0; i < len; i++) {\n            var s = this.streams[i];\n            if (s.name === name) {\n                stream = s;\n                break;\n            }\n        }\n        if (!stream) {\n            throw new Error(format('no stream with name \"%s\"', name));\n        }\n    }\n    if (value === undefined) {\n        return stream.level;\n    } else {\n        var newLevel = resolveLevel(value);\n        stream.level = newLevel;\n        if (newLevel < this._level) {\n            this._level = newLevel;\n        }\n    }\n}\n\n\n/**\n * Apply registered serializers to the appropriate keys in the given fields.\n *\n * Pre-condition: This is only called if there is at least one serializer.\n *\n * @param fields (Object) The log record fields.\n * @param excludeFields (Object) Optional mapping of keys to `true` for\n *    keys to NOT apply a serializer.\n */\nLogger.prototype._applySerializers = function (fields, excludeFields) {\n    var self = this;\n\n    xxx('_applySerializers: excludeFields', excludeFields);\n\n    // Check each serializer against these (presuming number of serializers\n    // is typically less than number of fields).\n    Object.keys(this.serializers).forEach(function (name) {\n        if (fields[name] === undefined ||\n            (excludeFields && excludeFields[name]))\n        {\n            return;\n        }\n        xxx('_applySerializers; apply to \"%s\" key', name)\n        try {\n            fields[name] = self.serializers[name](fields[name]);\n        } catch (err) {\n            _warn(format('bunyan: ERROR: Exception thrown from the \"%s\" '\n                + 'Bunyan serializer. This should never happen. This is a bug '\n                + 'in that serializer function.\\n%s',\n                name, err.stack || err));\n            fields[name] = format('(Error in Bunyan log \"%s\" serializer '\n                + 'broke field. See stderr for details.)', name);\n        }\n    });\n}\n\n\n/**\n * Emit a log record.\n *\n * @param rec {log record}\n * @param noemit {Boolean} Optional. Set to true to skip emission\n *      and just return the JSON string.\n */\nLogger.prototype._emit = function (rec, noemit) {\n    var i;\n\n    // Lazily determine if this Logger has non-'raw' streams. If there are\n    // any, then we need to stringify the log record.\n    if (this.haveNonRawStreams === undefined) {\n        this.haveNonRawStreams = false;\n        for (i = 0; i < this.streams.length; i++) {\n            if (!this.streams[i].raw) {\n                this.haveNonRawStreams = true;\n                break;\n            }\n        }\n    }\n\n    // Stringify the object (creates a warning str on error).\n    var str;\n    if (noemit || this.haveNonRawStreams) {\n        str = fastAndSafeJsonStringify(rec) + os.EOL;\n    }\n\n    if (noemit)\n        return str;\n\n    var level = rec.level;\n    for (i = 0; i < this.streams.length; i++) {\n        var s = this.streams[i];\n        if (s.level <= level) {\n            xxx('writing log rec \"%s\" to \"%s\" stream (%d <= %d): %j',\n                rec.msg, s.type, s.level, level, rec);\n            s.stream.write(s.raw ? rec : str);\n        }\n    };\n\n    return str;\n}\n\n\n/**\n * Build a record object suitable for emitting from the arguments\n * provided to the a log emitter.\n */\nfunction mkRecord(log, minLevel, args) {\n    var excludeFields, fields, msgArgs;\n    if (args[0] instanceof Error) {\n        // `log.<level>(err, ...)`\n        fields = {\n            // Use this Logger's err serializer, if defined.\n            err: (log.serializers && log.serializers.err\n                ? log.serializers.err(args[0])\n                : Logger.stdSerializers.err(args[0]))\n        };\n        excludeFields = {err: true};\n        if (args.length === 1) {\n            msgArgs = [fields.err.message];\n        } else {\n            msgArgs = args.slice(1);\n        }\n    } else if (typeof (args[0]) !== 'object' || Array.isArray(args[0])) {\n        // `log.<level>(msg, ...)`\n        fields = null;\n        msgArgs = args.slice();\n    } else if (Buffer.isBuffer(args[0])) {  // `log.<level>(buf, ...)`\n        // Almost certainly an error, show `inspect(buf)`. See bunyan\n        // issue #35.\n        fields = null;\n        msgArgs = args.slice();\n        msgArgs[0] = util.inspect(msgArgs[0]);\n    } else {  // `log.<level>(fields, msg, ...)`\n        fields = args[0];\n        if (fields && args.length === 1 && fields.err &&\n            fields.err instanceof Error)\n        {\n            msgArgs = [fields.err.message];\n        } else {\n            msgArgs = args.slice(1);\n        }\n    }\n\n    // Build up the record object.\n    var rec = objCopy(log.fields);\n    var level = rec.level = minLevel;\n    var recFields = (fields ? objCopy(fields) : null);\n    if (recFields) {\n        if (log.serializers) {\n            log._applySerializers(recFields, excludeFields);\n        }\n        Object.keys(recFields).forEach(function (k) {\n            rec[k] = recFields[k];\n        });\n    }\n    rec.msg = format.apply(log, msgArgs);\n    if (!rec.time) {\n        rec.time = (new Date());\n    }\n    // Get call source info\n    if (log.src && !rec.src) {\n        rec.src = getCaller3Info()\n    }\n    rec.v = LOG_VERSION;\n\n    return rec;\n};\n\n\n/**\n * Build an array that dtrace-provider can use to fire a USDT probe. If we've\n * already built the appropriate string, we use it. Otherwise, build the\n * record object and stringify it.\n */\nfunction mkProbeArgs(str, log, minLevel, msgArgs) {\n    return [ str || log._emit(mkRecord(log, minLevel, msgArgs), true) ];\n}\n\n\n/**\n * Build a log emitter function for level minLevel. I.e. this is the\n * creator of `log.info`, `log.error`, etc.\n */\nfunction mkLogEmitter(minLevel) {\n    return function () {\n        var log = this;\n        var str = null;\n        var rec = null;\n\n        if (!this._emit) {\n            /*\n             * Show this invalid Bunyan usage warning *once*.\n             *\n             * See <https://github.com/trentm/node-bunyan/issues/100> for\n             * an example of how this can happen.\n             */\n            var dedupKey = 'unbound';\n            if (!_haveWarned[dedupKey]) {\n                var caller = getCaller3Info();\n                _warn(format('bunyan usage error: %s:%s: attempt to log '\n                    + 'with an unbound log method: `this` is: %s',\n                    caller.file, caller.line, util.inspect(this)),\n                    dedupKey);\n            }\n            return;\n        } else if (arguments.length === 0) {   // `log.<level>()`\n            return (this._level <= minLevel);\n        }\n\n        var msgArgs = new Array(arguments.length);\n        for (var i = 0; i < msgArgs.length; ++i) {\n            msgArgs[i] = arguments[i];\n        }\n\n        if (this._level <= minLevel) {\n            rec = mkRecord(log, minLevel, msgArgs);\n            str = this._emit(rec);\n        }\n\n        if (probes) {\n            probes[minLevel].fire(mkProbeArgs, str, log, minLevel, msgArgs);\n        }\n    }\n}\n\n\n/**\n * The functions below log a record at a specific level.\n *\n * Usages:\n *    log.<level>()  -> boolean is-trace-enabled\n *    log.<level>(<Error> err, [<string> msg, ...])\n *    log.<level>(<string> msg, ...)\n *    log.<level>(<object> fields, <string> msg, ...)\n *\n * where <level> is the lowercase version of the log level. E.g.:\n *\n *    log.info()\n *\n * @params fields {Object} Optional set of additional fields to log.\n * @params msg {String} Log message. This can be followed by additional\n *    arguments that are handled like\n *    [util.format](http://nodejs.org/docs/latest/api/all.html#util.format).\n */\nLogger.prototype.trace = mkLogEmitter(TRACE);\nLogger.prototype.debug = mkLogEmitter(DEBUG);\nLogger.prototype.info = mkLogEmitter(INFO);\nLogger.prototype.warn = mkLogEmitter(WARN);\nLogger.prototype.error = mkLogEmitter(ERROR);\nLogger.prototype.fatal = mkLogEmitter(FATAL);\n\n\n\n//---- Standard serializers\n// A serializer is a function that serializes a JavaScript object to a\n// JSON representation for logging. There is a standard set of presumed\n// interesting objects in node.js-land.\n\nLogger.stdSerializers = {};\n\n// Serialize an HTTP request.\nLogger.stdSerializers.req = function (req) {\n    if (!req || !req.connection)\n        return req;\n    return {\n        method: req.method,\n        // Accept `req.originalUrl` for expressjs usage.\n        // https://expressjs.com/en/api.html#req.originalUrl\n        url: req.originalUrl || req.url,\n        headers: req.headers,\n        remoteAddress: req.connection.remoteAddress,\n        remotePort: req.connection.remotePort\n    };\n    // Trailers: Skipping for speed. If you need trailers in your app, then\n    // make a custom serializer.\n    //if (Object.keys(trailers).length > 0) {\n    //  obj.trailers = req.trailers;\n    //}\n};\n\n// Serialize an HTTP response.\nLogger.stdSerializers.res = function (res) {\n    if (!res || !res.statusCode)\n        return res;\n    return {\n        statusCode: res.statusCode,\n        header: res._header\n    }\n};\n\n\n/*\n * This function dumps long stack traces for exceptions having a cause()\n * method. The error classes from\n * [verror](https://github.com/davepacheco/node-verror) and\n * [restify v2.0](https://github.com/mcavage/node-restify) are examples.\n *\n * Based on `dumpException` in\n * https://github.com/davepacheco/node-extsprintf/blob/master/lib/extsprintf.js\n */\nfunction getFullErrorStack(ex)\n{\n    var ret = ex.stack || ex.toString();\n    if (ex.cause && typeof (ex.cause) === 'function') {\n        var cex = ex.cause();\n        if (cex) {\n            ret += '\\nCaused by: ' + getFullErrorStack(cex);\n        }\n    }\n    return (ret);\n}\n\n// Serialize an Error object\n// (Core error properties are enumerable in node 0.4, not in 0.6).\nvar errSerializer = Logger.stdSerializers.err = function (err) {\n    if (!err || !err.stack)\n        return err;\n    var obj = {\n        message: err.message,\n        name: err.name,\n        stack: getFullErrorStack(err),\n        code: err.code,\n        signal: err.signal\n    }\n    return obj;\n};\n\n\n// A JSON stringifier that handles cycles safely - tracks seen values in a Set.\nfunction safeCyclesSet() {\n    var seen = new Set();\n    return function (key, val) {\n        if (!val || typeof (val) !== 'object') {\n            return val;\n        }\n        if (seen.has(val)) {\n            return '[Circular]';\n        }\n        seen.add(val);\n        return val;\n    };\n}\n\n/**\n * A JSON stringifier that handles cycles safely - tracks seen vals in an Array.\n *\n * Note: This approach has performance problems when dealing with large objects,\n * see trentm/node-bunyan#445, but since this is the only option for node 0.10\n * and earlier (as Set was introduced in Node 0.12), it's used as a fallback\n * when Set is not available.\n */\nfunction safeCyclesArray() {\n    var seen = [];\n    return function (key, val) {\n        if (!val || typeof (val) !== 'object') {\n            return val;\n        }\n        if (seen.indexOf(val) !== -1) {\n            return '[Circular]';\n        }\n        seen.push(val);\n        return val;\n    };\n}\n\n/**\n * A JSON stringifier that handles cycles safely.\n *\n * Usage: JSON.stringify(obj, safeCycles())\n *\n * Choose the best safe cycle function from what is available - see\n * trentm/node-bunyan#445.\n */\nvar safeCycles = typeof (Set) !== 'undefined' ? safeCyclesSet : safeCyclesArray;\n\n/**\n * A fast JSON.stringify that handles cycles and getter exceptions (when\n * safeJsonStringify is installed).\n *\n * This function attempts to use the regular JSON.stringify for speed, but on\n * error (e.g. JSON cycle detection exception) it falls back to safe stringify\n * handlers that can deal with cycles and/or getter exceptions.\n */\nfunction fastAndSafeJsonStringify(rec) {\n    try {\n        return JSON.stringify(rec);\n    } catch (ex) {\n        try {\n            return JSON.stringify(rec, safeCycles());\n        } catch (e) {\n            if (safeJsonStringify) {\n                return safeJsonStringify(rec);\n            } else {\n                var dedupKey = e.stack.split(/\\n/g, 3).join('\\n');\n                _warn('bunyan: ERROR: Exception in '\n                    + '`JSON.stringify(rec)`. You can install the '\n                    + '\"safe-json-stringify\" module to have Bunyan fallback '\n                    + 'to safer stringification. Record:\\n'\n                    + _indent(format('%s\\n%s', util.inspect(rec), e.stack)),\n                    dedupKey);\n                return format('(Exception in JSON.stringify(rec): %j. '\n                    + 'See stderr for details.)', e.message);\n            }\n        }\n    }\n}\n\n\nvar RotatingFileStream = null;\nif (mv) {\n\nRotatingFileStream = function RotatingFileStream(options) {\n    this.path = options.path;\n\n    this.count = (options.count == null ? 10 : options.count);\n    assert.equal(typeof (this.count), 'number',\n        format('rotating-file stream \"count\" is not a number: %j (%s) in %j',\n            this.count, typeof (this.count), this));\n    assert.ok(this.count >= 0,\n        format('rotating-file stream \"count\" is not >= 0: %j in %j',\n            this.count, this));\n\n    // Parse `options.period`.\n    if (options.period) {\n        // <number><scope> where scope is:\n        //    h   hours (at the start of the hour)\n        //    d   days (at the start of the day, i.e. just after midnight)\n        //    w   weeks (at the start of Sunday)\n        //    m   months (on the first of the month)\n        //    y   years (at the start of Jan 1st)\n        // with special values 'hourly' (1h), 'daily' (1d), \"weekly\" (1w),\n        // 'monthly' (1m) and 'yearly' (1y)\n        var period = {\n            'hourly': '1h',\n            'daily': '1d',\n            'weekly': '1w',\n            'monthly': '1m',\n            'yearly': '1y'\n        }[options.period] || options.period;\n        var m = /^([1-9][0-9]*)([hdwmy]|ms)$/.exec(period);\n        if (!m) {\n            throw new Error(format('invalid period: \"%s\"', options.period));\n        }\n        this.periodNum = Number(m[1]);\n        this.periodScope = m[2];\n    } else {\n        this.periodNum = 1;\n        this.periodScope = 'd';\n    }\n\n    var lastModified = null;\n    try {\n        var fileInfo = fs.statSync(this.path);\n        lastModified = fileInfo.mtime.getTime();\n    }\n    catch (err) {\n        // file doesn't exist\n    }\n    var rotateAfterOpen = false;\n    if (lastModified) {\n        var lastRotTime = this._calcRotTime(0);\n        if (lastModified < lastRotTime) {\n            rotateAfterOpen = true;\n        }\n    }\n\n    // TODO: template support for backup files\n    // template: <path to which to rotate>\n    //      default is %P.%n\n    //      '/var/log/archive/foo.log'  -> foo.log.%n\n    //      '/var/log/archive/foo.log.%n'\n    //      codes:\n    //          XXX support strftime codes (per node version of those)\n    //              or whatever module. Pick non-colliding for extra\n    //              codes\n    //          %P      `path` base value\n    //          %n      integer number of rotated log (1,2,3,...)\n    //          %d      datetime in YYYY-MM-DD_HH-MM-SS\n    //                      XXX what should default date format be?\n    //                          prior art? Want to avoid ':' in\n    //                          filenames (illegal on Windows for one).\n\n    this.stream = fs.createWriteStream(this.path,\n        {flags: 'a', encoding: 'utf8'});\n\n    this.rotQueue = [];\n    this.rotating = false;\n    if (rotateAfterOpen) {\n        this._debug('rotateAfterOpen -> call rotate()');\n        this.rotate();\n    } else {\n        this._setupNextRot();\n    }\n}\n\nutil.inherits(RotatingFileStream, EventEmitter);\n\nRotatingFileStream.prototype._debug = function () {\n    // Set this to `true` to add debug logging.\n    if (false) {\n        if (arguments.length === 0) {\n            return true;\n        }\n        var args = Array.prototype.slice.call(arguments);\n        args[0] = '[' + (new Date().toISOString()) + ', '\n            + this.path + '] ' + args[0];\n        console.log.apply(this, args);\n    } else {\n        return false;\n    }\n};\n\nRotatingFileStream.prototype._setupNextRot = function () {\n    this.rotAt = this._calcRotTime(1);\n    this._setRotationTimer();\n}\n\nRotatingFileStream.prototype._setRotationTimer = function () {\n    var self = this;\n    var delay = this.rotAt - Date.now();\n    // Cap timeout to Node's max setTimeout, see\n    // <https://github.com/joyent/node/issues/8656>.\n    var TIMEOUT_MAX = 2147483647; // 2^31-1\n    if (delay > TIMEOUT_MAX) {\n        delay = TIMEOUT_MAX;\n    }\n    this.timeout = setTimeout(\n        function () {\n            self._debug('_setRotationTimer timeout -> call rotate()');\n            self.rotate();\n        },\n        delay);\n    if (typeof (this.timeout.unref) === 'function') {\n        this.timeout.unref();\n    }\n}\n\nRotatingFileStream.prototype._calcRotTime =\nfunction _calcRotTime(periodOffset) {\n    this._debug('_calcRotTime: %s%s', this.periodNum, this.periodScope);\n    var d = new Date();\n\n    this._debug('  now local: %s', d);\n    this._debug('    now utc: %s', d.toISOString());\n    var rotAt;\n    switch (this.periodScope) {\n    case 'ms':\n        // Hidden millisecond period for debugging.\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * periodOffset;\n        } else {\n            rotAt = Date.now() + this.periodNum * periodOffset;\n        }\n        break;\n    case 'h':\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * 60 * 60 * 1000 * periodOffset;\n        } else {\n            // First time: top of the next hour.\n            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),\n                d.getUTCDate(), d.getUTCHours() + periodOffset);\n        }\n        break;\n    case 'd':\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * 24 * 60 * 60 * 1000\n                * periodOffset;\n        } else {\n            // First time: start of tomorrow (i.e. at the coming midnight) UTC.\n            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),\n                d.getUTCDate() + periodOffset);\n        }\n        break;\n    case 'w':\n        // Currently, always on Sunday morning at 00:00:00 (UTC).\n        if (this.rotAt) {\n            rotAt = this.rotAt + this.periodNum * 7 * 24 * 60 * 60 * 1000\n                * periodOffset;\n        } else {\n            // First time: this coming Sunday.\n            var dayOffset = (7 - d.getUTCDay());\n            if (periodOffset < 1) {\n                dayOffset = -d.getUTCDay();\n            }\n            if (periodOffset > 1 || periodOffset < -1) {\n                dayOffset += 7 * periodOffset;\n            }\n            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),\n                d.getUTCDate() + dayOffset);\n        }\n        break;\n    case 'm':\n        if (this.rotAt) {\n            rotAt = Date.UTC(d.getUTCFullYear(),\n                d.getUTCMonth() + this.periodNum * periodOffset, 1);\n        } else {\n            // First time: the start of the next month.\n            rotAt = Date.UTC(d.getUTCFullYear(),\n                d.getUTCMonth() + periodOffset, 1);\n        }\n        break;\n    case 'y':\n        if (this.rotAt) {\n            rotAt = Date.UTC(d.getUTCFullYear() + this.periodNum * periodOffset,\n                0, 1);\n        } else {\n            // First time: the start of the next year.\n            rotAt = Date.UTC(d.getUTCFullYear() + periodOffset, 0, 1);\n        }\n        break;\n    default:\n        assert.fail(format('invalid period scope: \"%s\"', this.periodScope));\n    }\n\n    if (this._debug()) {\n        this._debug('  **rotAt**: %s (utc: %s)', rotAt,\n            new Date(rotAt).toUTCString());\n        var now = Date.now();\n        this._debug('        now: %s (%sms == %smin == %sh to go)',\n            now,\n            rotAt - now,\n            (rotAt-now)/1000/60,\n            (rotAt-now)/1000/60/60);\n    }\n    return rotAt;\n};\n\nRotatingFileStream.prototype.rotate = function rotate() {\n    // XXX What about shutdown?\n    var self = this;\n\n    // If rotation period is > ~25 days, we have to break into multiple\n    // setTimeout's. See <https://github.com/joyent/node/issues/8656>.\n    if (self.rotAt && self.rotAt > Date.now()) {\n        return self._setRotationTimer();\n    }\n\n    this._debug('rotate');\n    if (self.rotating) {\n        throw new TypeError('cannot start a rotation when already rotating');\n    }\n    self.rotating = true;\n\n    self.stream.end();  // XXX can do moves sync after this? test at high rate\n\n    function del() {\n        var toDel = self.path + '.' + String(n - 1);\n        if (n === 0) {\n            toDel = self.path;\n        }\n        n -= 1;\n        self._debug('  rm %s', toDel);\n        fs.unlink(toDel, function (delErr) {\n            //XXX handle err other than not exists\n            moves();\n        });\n    }\n\n    function moves() {\n        if (self.count === 0 || n < 0) {\n            return finish();\n        }\n        var before = self.path;\n        var after = self.path + '.' + String(n);\n        if (n > 0) {\n            before += '.' + String(n - 1);\n        }\n        n -= 1;\n        fs.exists(before, function (exists) {\n            if (!exists) {\n                moves();\n            } else {\n                self._debug('  mv %s %s', before, after);\n                mv(before, after, function (mvErr) {\n                    if (mvErr) {\n                        self.emit('error', mvErr);\n                        finish(); // XXX finish here?\n                    } else {\n                        moves();\n                    }\n                });\n            }\n        })\n    }\n\n    function finish() {\n        self._debug('  open %s', self.path);\n        self.stream = fs.createWriteStream(self.path,\n            {flags: 'a', encoding: 'utf8'});\n        var q = self.rotQueue, len = q.length;\n        for (var i = 0; i < len; i++) {\n            self.stream.write(q[i]);\n        }\n        self.rotQueue = [];\n        self.rotating = false;\n        self.emit('drain');\n        self._setupNextRot();\n    }\n\n    var n = this.count;\n    del();\n};\n\nRotatingFileStream.prototype.write = function write(s) {\n    if (this.rotating) {\n        this.rotQueue.push(s);\n        return false;\n    } else {\n        return this.stream.write(s);\n    }\n};\n\nRotatingFileStream.prototype.end = function end(s) {\n    this.stream.end();\n};\n\nRotatingFileStream.prototype.destroy = function destroy(s) {\n    this.stream.destroy();\n};\n\nRotatingFileStream.prototype.destroySoon = function destroySoon(s) {\n    this.stream.destroySoon();\n};\n\n} /* if (mv) */\n\n\n\n/**\n * RingBuffer is a Writable Stream that just stores the last N records in\n * memory.\n *\n * @param options {Object}, with the following fields:\n *\n *    - limit: number of records to keep in memory\n */\nfunction RingBuffer(options) {\n    this.limit = options && options.limit ? options.limit : 100;\n    this.writable = true;\n    this.records = [];\n    EventEmitter.call(this);\n}\n\nutil.inherits(RingBuffer, EventEmitter);\n\nRingBuffer.prototype.write = function (record) {\n    if (!this.writable)\n        throw (new Error('RingBuffer has been ended already'));\n\n    this.records.push(record);\n\n    if (this.records.length > this.limit)\n        this.records.shift();\n\n    return (true);\n};\n\nRingBuffer.prototype.end = function () {\n    if (arguments.length > 0)\n        this.write.apply(this, Array.prototype.slice.call(arguments));\n    this.writable = false;\n};\n\nRingBuffer.prototype.destroy = function () {\n    this.writable = false;\n    this.emit('close');\n};\n\nRingBuffer.prototype.destroySoon = function () {\n    this.destroy();\n};\n\n\n//---- Exports\n\nmodule.exports = Logger;\n\nmodule.exports.TRACE = TRACE;\nmodule.exports.DEBUG = DEBUG;\nmodule.exports.INFO = INFO;\nmodule.exports.WARN = WARN;\nmodule.exports.ERROR = ERROR;\nmodule.exports.FATAL = FATAL;\nmodule.exports.resolveLevel = resolveLevel;\nmodule.exports.levelFromName = levelFromName;\nmodule.exports.nameFromLevel = nameFromLevel;\n\nmodule.exports.VERSION = VERSION;\nmodule.exports.LOG_VERSION = LOG_VERSION;\n\nmodule.exports.createLogger = function createLogger(options) {\n    return new Logger(options);\n};\n\nmodule.exports.RingBuffer = RingBuffer;\nmodule.exports.RotatingFileStream = RotatingFileStream;\n\n// Useful for custom `type == 'raw'` streams that may do JSON stringification\n// of log records themselves. Usage:\n//    var str = JSON.stringify(rec, bunyan.safeCycles());\nmodule.exports.safeCycles = safeCycles;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}